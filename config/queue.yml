default: &default
  dispatchers:
    - polling_interval: 1
      batch_size: 500
  workers:
    - queues: "*"
      threads: 3
      processes: 1
      polling_interval: 0.1

development:
  <<: *default

test:
  <<: *default

# Production: prioritize web UX over job throughput
# CPU-heavy jobs (galleries, thumbnails) run with low concurrency
# to avoid starving web requests of CPU time
production:
  dispatchers:
    - polling_interval: 1
      batch_size: 500
  workers:
    # CPU-heavy: PDF-to-image conversion (ImageMagick/Ghostscript)
    # Temporarily 3 threads for initial bulk run (reduce to 1 after)
    - queues:
        - galleries
        - thumbnails
      threads: 3
      processes: 1
      polling_interval: 1

    # I/O-heavy: downloading PDFs from external servers
    # Can overlap network waits, so 2 threads OK
    - queues:
        - pdfs
      threads: 2
      processes: 1
      polling_interval: 0.5

    # Default: batch orchestrators, imports, sitemap, cache
    # Mostly I/O-bound or quick dispatch jobs
    - queues:
        - default
      threads: 2
      processes: 1
      polling_interval: 0.5
