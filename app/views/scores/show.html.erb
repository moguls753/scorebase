<div class="max-w-[1400px] mx-auto px-6 py-10">
  <!-- Back button -->
  <div class="mb-6">
    <%= link_to scores_path, class: "mm-button mm-button-secondary inline-flex items-center gap-2 text-xs px-4 py-2" do %>
      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      Back
    <% end %>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Score Preview -->
    <div class="mm-card overflow-hidden h-[700px]">
      <% if @score.preview_image.attached? %>
        <!-- High-res preview (1200px) -->
        <%= image_tag @score.preview_image,
            alt: @score.title,
            class: "w-full h-full object-contain bg-[var(--color-bg)]"
        %>
      <% elsif @score.thumbnail_image.attached? %>
        <!-- Thumbnail fallback (400px) -->
        <%= image_tag @score.thumbnail_image,
            alt: @score.title,
            class: "w-full h-full object-contain bg-[var(--color-bg)]"
        %>
      <% elsif @score.has_pdf? %>
        <!-- No preview available - show link to open PDF -->
        <div class="w-full h-full bg-[var(--color-bg)] flex flex-col items-center justify-center gap-6 p-8">
          <div class="text-[120px] text-[var(--color-border-subtle)]">ðŸ“„</div>
          <div class="text-center">
            <p class="text-sm font-semibold text-[var(--color-text-muted)] mb-4">
              Preview not generated yet
            </p>
            <%= link_to file_score_path(@score, 'pdf'),
                target: "_blank",
                rel: "noopener noreferrer",
                class: "mm-button mm-button-primary inline-flex items-center gap-2 text-xs px-6 py-3" do %>
              <span>Open PDF â†—</span>
            <% end %>
          </div>
        </div>
      <% else %>
        <!-- No PDF at all -->
        <div class="w-full h-full bg-[var(--color-bg)] flex items-center justify-center">
          <div class="text-[140px] text-[var(--color-border-subtle)]">â™ª</div>
        </div>
      <% end %>
    </div>

    <!-- Score Details -->
    <div>
      <h1 class="text-4xl font-[var(--font-family-display)] text-[var(--color-primary)] mb-2 leading-tight font-black uppercase tracking-tight">
        <%= @score.title %>
      </h1>

      <div class="flex items-center gap-3 mb-6">
        <p class="text-base text-[var(--color-text-muted)] font-semibold">
          <%= @score.composer.presence || "Unknown Composer" %>
        </p>
        <% if @score.source.present? %>
          <span class="mm-badge-source mm-badge-<%= @score.source %>">
            <%= @score.source.upcase %>
          </span>
        <% end %>
      </div>

      <!-- Metadata -->
      <div class="mm-card p-5 mb-6">
        <h3 class="text-sm font-[var(--font-family-display)] text-[var(--color-primary)] mb-4 font-black uppercase tracking-tight">Details</h3>
        <dl class="space-y-2">
          <% if @score.primary_key_signature.present? %>
            <div class="flex items-center justify-between py-2 border-b-2 border-[var(--color-border-subtle)]">
              <dt class="text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wide">Key</dt>
              <dd class="text-xs font-bold text-[var(--color-text)]"><%= @score.primary_key_signature %></dd>
            </div>
          <% end %>
          <% if @score.primary_time_signature.present? %>
            <div class="flex items-center justify-between py-2 border-b-2 border-[var(--color-border-subtle)]">
              <dt class="text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wide">Time</dt>
              <dd class="text-xs font-bold text-[var(--color-text)]"><%= @score.primary_time_signature %></dd>
            </div>
          <% end %>
          <% if @score.num_parts.present? %>
            <div class="flex items-center justify-between py-2 border-b-2 border-[var(--color-border-subtle)]">
              <dt class="text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wide">Parts</dt>
              <dd class="text-xs font-bold text-[var(--color-text)]"><%= @score.num_parts %></dd>
            </div>
          <% end %>
          <% if @score.complexity.present? && @score.complexity > 0 %>
            <div class="flex items-center justify-between py-2 border-b-2 border-[var(--color-border-subtle)]">
              <dt class="text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wide">Complexity</dt>
              <dd class="text-xs font-bold text-[var(--color-text)]"><%= @score.complexity %> / 3</dd>
            </div>
          <% end %>
          <% if @score.rating.present? && @score.rating > 0 %>
            <div class="flex items-center justify-between py-2">
              <dt class="text-xs font-semibold text-[var(--color-text-muted)] uppercase tracking-wide">Rating</dt>
              <dd class="text-xs font-bold text-[var(--color-text)]"><%= number_with_precision(@score.rating, precision: 1) %> / 5.0</dd>
            </div>
          <% end %>
        </dl>
      </div>

      <!-- Genres/Tags -->
      <% if @score.genre_list.any? %>
        <div class="mb-6">
          <h3 class="text-xs font-semibold text-[var(--color-text-muted)] mb-3 uppercase tracking-wide">Genres</h3>
          <div class="flex flex-wrap gap-2">
            <% @score.genre_list.each do |genre| %>
              <span class="mm-badge">
                <%= genre %>
              </span>
            <% end %>
          </div>
        </div>
      <% end %>

      <!-- Download Actions -->
      <div class="space-y-2">
        <% if @score.has_mxl? %>
          <%= link_to file_score_path(@score, 'mxl', download: true), class: "mm-button mm-button-primary block w-full text-center py-3 text-xs" do %>
            <span class="inline-flex items-center gap-2">
              <span>â†“</span> Download MusicXML
            </span>
          <% end %>
        <% end %>
        <% if @score.has_pdf? %>
          <%= link_to file_score_path(@score, 'pdf', download: true), class: "mm-button mm-button-secondary block w-full text-center py-3 text-xs" do %>
            <span class="inline-flex items-center gap-2">
              <span>â†“</span> Download PDF
            </span>
          <% end %>
        <% end %>
        <% if @score.has_midi? %>
          <%= link_to file_score_path(@score, 'mid', download: true), class: "mm-button mm-button-secondary block w-full text-center py-3 text-xs" do %>
            <span class="inline-flex items-center gap-2">
              <span>â†“</span> Download MIDI
            </span>
          <% end %>
        <% end %>
        <% if @score.external_url.present? %>
          <div class="pt-2 border-t-2 border-[var(--color-border-subtle)]"></div>
          <%= link_to @score.external_url, target: "_blank", rel: "noopener noreferrer", class: "mm-button mm-button-secondary block w-full text-center py-3 text-xs" do %>
            <span class="inline-flex items-center gap-2">
              View on <%= @score.source.upcase %> <span>â†—</span>
            </span>
          <% end %>
        <% end %>
      </div>

      <!-- Stats -->
      <div class="mt-6 pt-6 border-t-2 border-[var(--color-border-subtle)] flex gap-6 text-xs">
        <div>
          <span class="font-black text-[var(--color-accent)]"><%= @score.views %></span>
          <span class="text-[var(--color-text-muted)] font-semibold uppercase ml-1">views</span>
        </div>
        <div>
          <span class="font-black text-[var(--color-accent)]"><%= @score.favorites %></span>
          <span class="text-[var(--color-text-muted)] font-semibold uppercase ml-1">favs</span>
        </div>
      </div>
    </div>
  </div>
</div>
